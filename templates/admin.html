<div class="card">
    <h2><i class="fas fa-chart-bar"></i> Thống kê Hoạt động</h2>
    <div class="form-group" style="margin-top: 30px;">
        <h2><i class="fas fa-cookie-bite"></i> Cấu hình Cookie</h2>
        <p>Trạng thái Cookie hiện tại: 
            <span id="cookie_status_span" class="status-badge {% if 'Đã tải' in cookie_status %}status-Finished{% else %}status-Error{% endif %}">
                {{ cookie_status }}
            </span>
        </p>
        
        <div class="cookie-check-area">
            <button id="btn_check_cookie" onclick="checkCookieLiveStatus()"><i class="fas fa-sync-alt"></i> Kiểm tra Live Token</button>
            <span id="live_status_display" class="live-status live-unknown">Chưa kiểm tra</span>
        </div>
        <form id="upload_form" style="margin-top: 15px;">
            <label for="cookie_text" style="display: block; font-weight: bold; margin-bottom: 5px;"><i class="fas fa-file-code"></i> Dán chuỗi Cookie JSON:</label>
            <textarea id="cookie_text" name="cookie_text" rows="8" placeholder="Dán nội dung file cookie.json vào đây..." 
                      style="width: 100%; resize: vertical; background-color: #1a1a2e; color: white; border: 1px solid #6a0dad; padding: 10px; box-sizing: border-box; font-family: monospace;"></textarea>
            
            <button type="submit" style="width: 100%; margin-top: 10px;"><i class="fas fa-save"></i> Lưu & Cập nhật Cookie</button>
        </form>
        <p id="upload_message" style="margin-top: 10px; font-weight: bold;"></p>
    </div>
    
</div>

<script>
    // ... (logic JavaScript khác giữ nguyên) ...
    
    // SỬA: Thay đổi cách gửi dữ liệu cookie
    document.getElementById('upload_form').addEventListener('submit', async (e) => {
        e.preventDefault(); 
        const cookieText = document.getElementById('cookie_text').value.trim();
        const messageElement = document.getElementById('upload_message');
        const statusSpan = document.getElementById('cookie_status_span');

        messageElement.textContent = 'Đang xử lý...';
        messageElement.style.color = '#fec95a';

        try {
            // Kiểm tra cú pháp cơ bản
            const parsedData = JSON.parse(cookieText);

            const response = await fetch('/admin/upload_cookie_text', { // NEW ENDPOINT
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ cookie_data: parsedData })
            });

            const result = await response.json();
            messageElement.textContent = result.message;

            if (result.success) {
                statusSpan.textContent = 'Đã tải';
                statusSpan.className = 'status-badge status-Finished';
                messageElement.style.color = '#4CAF50';
                checkCookieLiveStatus();
            } else {
                 statusSpan.textContent = 'Lỗi';
                 statusSpan.className = 'status-badge status-Error';
                 messageElement.style.color = '#ff6347';
            }
        } catch (error) {
             messageElement.textContent = `Lỗi: Cú pháp JSON không hợp lệ. (${error.message})`;
             statusSpan.className = 'status-badge status-Error';
             messageElement.style.color = '#ff6347';
        }
    });

    // ... (logic JavaScript khác giữ nguyên) ...
</script>
